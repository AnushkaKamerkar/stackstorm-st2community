version: 1.0

description: Send update to given channel.

input:
  - channel
  - body
  - user
  - delta

tasks:
  build-message:
    action: st2community.build-text
    parameters:
      body: <% ctx(body) %>
      user: <% ctx(user) %>
      delta: <% ctx(delta) %> 
    next:
      - when: <% succeeded() %>
        do: send-message
        publish:
          message: <% result().body %>
  send-message:
    action: slack.chat.postMessage
    parameters:
      channel: <% ctx(channel) %>
      text: <% ctx(message) %>
